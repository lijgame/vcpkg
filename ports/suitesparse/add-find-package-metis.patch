From fa93a324126823478eb7426cf486f20fba8132e8 Mon Sep 17 00:00:00 2001
From: Jack Li <Jack.li@autodesk.com>
Date: Thu, 20 Feb 2020 12:18:28 +0800
Subject: [PATCH] add-find-package-metis

---
 CMakeLists.txt                            | 5 ++++-
 SuiteSparse/CMakeLists.txt                | 2 +-
 cmake/SuiteSparse-config-install.cmake.in | 1 +
 3 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 3b3f436..9e2a72c 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -243,12 +243,15 @@ else()
 endif()
 
 IF(BUILD_METIS OR USE_VCPKG_METIS)
+	find_package(metis REQUIRED)
 	set(SuiteSparse_LINKER_METIS_LIBS "metis")
 	## namespaced library target for config
-	set(SuiteSparse_EXPORTED_METIS_LIBS "SuiteSparse::metis")
+	set(SuiteSparse_EXPORTED_METIS_LIBS "metis")
+	set(SuiteSparse_FIND_PACKAGE_METIS "find_package(metis REQUIRED)")
 else()
 	set(SuiteSparse_LINKER_METIS_LIBS "")
 	set(SuiteSparse_EXPORTED_METIS_LIBS "")
+	set(SuiteSparse_FIND_PACKAGE_METIS "")
 ENDIF()
 
 add_subdirectory(SuiteSparse)
diff --git a/SuiteSparse/CMakeLists.txt b/SuiteSparse/CMakeLists.txt
index 5ef08a6..6c7abfd 100644
--- a/SuiteSparse/CMakeLists.txt
+++ b/SuiteSparse/CMakeLists.txt
@@ -13,7 +13,7 @@ ENDIF(CMAKE_COMPILER_IS_GNUCXX AND NOT CMAKE_BUILD_TYPE MATCHES "Debug")
 
 # Global flags:
 IF (BUILD_METIS OR USE_VCPKG_METIS)
-	INCLUDE_DIRECTORIES("${METIS_SOURCE_DIR}/include")
+	#INCLUDE_DIRECTORIES("${METIS_SOURCE_DIR}/include")
 ELSE ()
 	ADD_DEFINITIONS(-DNPARTITION)
 ENDIF ()
diff --git a/cmake/SuiteSparse-config-install.cmake.in b/cmake/SuiteSparse-config-install.cmake.in
index 4e59b1f..68794d2 100644
--- a/cmake/SuiteSparse-config-install.cmake.in
+++ b/cmake/SuiteSparse-config-install.cmake.in
@@ -14,6 +14,7 @@ else()
   find_dependency(LAPACK)
 endif ()
 
+@SuiteSparse_FIND_PACKAGE_METIS@
 # Load targets from the install tree.
 include(${_SuiteSparse_SELF_DIR}/suitesparse-targets.cmake)
 
-- 
2.21.0.windows.1

